# awk

## 目录

-   [语法格式](#语法格式)
-   [工作原理](#工作原理)
-   [awk内部变量](#awk内部变量)
-   [awk格式输出printf](#awk格式输出printf)
    -   [语法格式](#语法格式)
        -   [实践printf](#实践printf)
    -   [模式匹配](#模式匹配)
        -   [匹配运算符示例](#匹配运算符示例)
    -   [布尔运算](#布尔运算)
-   [awk数组](#awk数组)
    -   [小技巧](#小技巧)

## 语法格式

第一种：`awk 'BEGIN{} pattern {commands} END {}' file_name`

第二种：`standard output | awk BEGIN{} pattern {commands}  END {}`

第三种：`awk -f awk-script-file filenames` （将命令集合写入文件。进行调用）

解释：BEGIN{} ： 正式处理数据之前执行。pattern：匹配模式（正则，grep）{commands} ： 处理文件命令 。END{}：处理完所有匹配数据后执行

## 工作原理

例如：`awk -F ':' '{print $1,$3}' /etc/passwd`

1.awk将文件中的每一行作为输入, 并将每一行赋给内部
变量\$0, 以换行符结束

2.awk开始进行字段分解，每个字段存储在已编号的变量
中，从\$1开始\[默认空格分割]

3.awk默认字段分隔符是由内部FS变量来确定, 可以使
用-F修订

4.awk行处理时使用了print函数打印分割后的字段

s5.awk在打印后的字段加上空格，因为\$1,\$3 之间有一
个逗号。逗号被映射至OFS内部变量中，称为输出字段
分隔符， OFS默认为空格.

6.awk输出之后，将从文件中获取另一行，并将其存储
在\$0中，覆盖原来的内容，然后将新的字符串分隔成字
段并进行处理。该过程将持续到所有行处理完毕

## awk内部变量

| 内置变量    | 含义                     |
| ------- | ---------------------- |
| \$0     | 整行内容                   |
| \$1-\$n | 当前行的第1-n个字段            |
| NF      | 当前行的字段个数，也就是多少列        |
| NR      | 当前的行号。从1开始计数           |
| FS      | 输入字段分隔符，不指定默认以空格或tab分割 |
| RS      | 输入行分隔符。默认回车执行          |
| OFS     | 输出字段分隔符，默认为空格          |
| ORS     | 输出行分隔符，默认回车执行          |

1.读入一行文件，默认是以 换行作为读入分隔符的（RS），读入进来后，会赋值给\$0，同时会为其编号赋值给NR变量；

2.检查FS变量是否有指定字段分隔符，按照字段分隔符拆分成列的形式，将每一列的内容赋值给对应的 \$1 \$2\$3 等内部变量。同时会将分隔后的总列数赋值给 NF变量；

3.输出内容，输出时候会使用print，\$1,\$3 这个逗号是输出字段分隔符，由OFS变量控制，默认是空；

4.输出内容默认是按照换行符展示，由ORS控制，控制输出行分隔符，默认是换行符；

## awk格式输出printf

awk可以通过printf函数生成数据报表

### 语法格式

| 格式符 | 含义      |
| --- | ------- |
| %s  | 打印字符串   |
| %d  | 打印十进制数  |
| %f  | 打印小数    |
| %x  | 打印十六进制数 |
| 修饰符 | 含义      |
| -   | 左对齐     |
| +   | 右对齐     |

```bash
#使用占位符美化输出
awk 'BEGIN{FS=":"} {printf "%20s %20s\n",$1,$7}' /etc/passwd
#默认右对齐，-是左对齐
awk 'BEGIN{FS=":"} {printf "%-20s %-20s\n",$1,$7}' /etc/passwd

```

#### 实践printf

美化成绩单

```bash
BEGIN {
  printf "%-10s%-10s%-10s%-10s%-10s\n","Name","Yuwen","Shuxue","yinyu","qita"
}
{ 
  printf  "%-10s%-10d%-10d%-10d%-10d\n",$1,$2,$3,$4,$5
}
```

### 模式匹配

awk 第一种模式：regexp

第二种模式：运算匹配，布尔值匹配，数学运算符匹配

#### 匹配运算符示例

匹配运算符：

：大于

<=：小于等于

\=：大于等于

\==：等于

!=：不等于

\~：正则匹配

!\~：不匹配正则

<：大于

### 布尔运算

&&：与。|：或。！：非

## awk数组

数组其实也算是变量, 传统的变量只能存储一个值，
但数组可以存储多个值。

不区分 关联数组 普通数组

### 小技巧

1.在awk中，使用数组时，不仅可以使用1 2 3 ..n
作为数组索引，也可以使用字符串作为数组索引。

2.要统计某个字段的值，就将该字段作为数组的索
引，然后对索引进行遍历。

1.统计谁旧将谁作为索引的名称；

2.然后让其相同的进行自增；

3.遍历索引名称，获取对应出现的值，也就是次
数；
